<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Thanh toán thành công - Tạp hóa Bà Trâm</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      :root {
        --primary: #1581fc;
        --secondary: #2c3e50;
        --success: #2ecc71;
        --dark: #2c3e50;
        --light: #f8f9fa;
      }

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        color: #333;
        background-color: var(--light);
        margin: 0;
        padding: 0;
      }

      header {
        background-color: var(--primary);
        color: white;
        padding: 1rem;
        text-align: center;
        position: relative;
        min-height: 80px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .header-content {
        max-width: 100%;
        padding: 0 100px;
        margin: 0 40px;
      }

      .header-title {
        margin: 0;
        font-size: 1.5rem;
        white-space: normal;
        word-break: break-word;
      }

      .container {
        max-width: 800px;
        margin: 40px auto;
        padding: 20px;
        background: white;
        border-radius: 10px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
      }

      .success-icon {
        text-align: center;
        color: var(--success);
        font-size: 60px;
        margin-bottom: 20px;
      }

      .order-details {
        margin: 30px 0;
        border: 1px solid #eee;
        border-radius: 8px;
        overflow: hidden;
      }

      .order-header {
        background-color: var(--dark);
        color: white;
        padding: 15px;
        font-weight: bold;
      }

      .order-body {
        padding: 20px;
      }

      .detail-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
        padding-bottom: 10px;
        border-bottom: 1px dashed #eee;
      }

      .detail-row:last-child {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
      }

      .detail-label {
        font-weight: bold;
        color: var(--dark);
      }

      .detail-value {
        text-align: right;
      }

      .total-amount {
        font-size: 1.2rem;
        font-weight: bold;
        color: var(--primary);
      }

      .action-buttons {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-top: 30px;
      }

      .btn {
        display: inline-block;
        padding: 12px 25px;
        color: white;
        text-decoration: none;
        border-radius: 5px;
        transition: all 0.3s;
        font-weight: 500;
        text-align: center;
      }

      .btn-primary {
        background: var(--primary);
      }

      .btn-secondary {
        background: var(--dark);
      }

      .btn:hover {
        opacity: 0.9;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      footer {
        background-color: var(--dark);
        color: white;
        text-align: center;
        padding: 20px;
        margin-top: 40px;
      }

      .products-list {
        margin-top: 20px;
      }

      .product-item {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 15px;
        border-bottom: 1px solid #eee;
      }

      .product-image {
        width: 60px;
        height: 60px;
        object-fit: contain;
        border: 1px solid #ddd;
        border-radius: 5px;
        margin-right: 15px;
      }

      .product-info {
        flex: 1;
      }

      .product-name {
        font-weight: 500;
        margin-bottom: 5px;
      }

      .product-price {
        color: #666;
      }

      @media (max-width: 768px) {
        .header-content {
          padding: 0 20px;
        }

        .container {
          margin: 20px;
          padding: 15px;
        }

        .action-buttons {
          flex-direction: column;
        }

        .btn {
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <div class="header-content">
        <h1 class="header-title">TẠP HÓA BÀ TRÂM - THANH TOÁN THÀNH CÔNG</h1>
      </div>
    </header>

    <div class="container">
      <div class="success-icon">
        <i class="fas fa-check-circle"></i>
      </div>

      <h2 style="text-align: center">Cảm ơn bạn đã mua hàng!</h2>
      <p style="text-align: center">
        Đơn hàng của bạn đã được xử lý thành công. Dưới đây là thông tin chi tiết:
      </p>

      <div class="order-details">
        <div class="order-header"><i class="fas fa-receipt"></i> THÔNG TIN ĐƠN HÀNG</div>
        <div class="order-body">
          <div class="detail-row">
            <span class="detail-label">Mã đơn hàng:</span>
            <span class="detail-value" id="order-id">Đang tải...</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Ngày đặt hàng:</span>
            <span class="detail-value" id="order-date">Đang tải...</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Phương thức thanh toán:</span>
            <span class="detail-value" id="payment-method">Đang tải...</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Trạng thái:</span>
            <span
              class="detail-value"
              style="color: var(--success); font-weight: bold"
              id="order-status"
              >Đang tải...</span
            >
          </div>

          <h3 style="margin-top: 25px">Sản phẩm đã mua:</h3>
          <div class="products-list" id="products-list">
            <!-- Sản phẩm sẽ được thêm bằng JavaScript -->
          </div>
          <!-- ORDER DATA PLACEHOLDER - WILL BE REPLACED BY WORKER -->
          <!--ORDER_DATA-->
          <div
            class="detail-row"
            style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #eee"
          >
            <span class="detail-label">Tổng tiền:</span>
            <span class="detail-value total-amount" id="total-amount">0 ₫</span>
          </div>
        </div>
      </div>

      <div class="action-buttons">
        <a href="https://mhcomputer.org/" class="btn btn-primary">
          <i class="fas fa-home"></i> Về trang chủ
        </a>
        <a href="https://mhcomputer.org/" class="btn btn-secondary">
          <i class="fas fa-shopping-bag"></i> Tiếp tục mua sắm
        </a>
      </div>

      <div style="margin-top: 30px; text-align: center; font-size: 0.9em; color: #666">
        <p>Nếu có bất kỳ câu hỏi nào, vui lòng liên hệ:</p>
        <p><i class="fas fa-phone"></i> Hotline: Một tám không không chín không có cái lon</p>
        <p><i class="fas fa-envelope"></i> Email: info@mhcomputer.org</p>
      </div>
    </div>

    <footer>
      <p>Copyright © 2025 Đào Minh Hải - Đừng tin vào những gì nhìn thấy</p>
      <p>Powered by Demo by DMH</p>
    </footer>

    <script>
      document.addEventListener('DOMContentLoaded', async function () {
        // Lấy thông tin từ URL
        const urlParams = new URLSearchParams(window.location.search);
        const orderId = urlParams.get('orderId');
        const paymentMethod = urlParams.get('paymentMethod') || 'QR Code';

        // Hiển thị thông tin cơ bản
        document.getElementById('order-id').textContent = orderId || '---';
        document.getElementById('payment-method').textContent = getPaymentMethodName(paymentMethod);
        document.getElementById('order-date').textContent = new Date().toLocaleString('vi-VN');
        document.getElementById('order-status').textContent = 'Thành công';

        try {
          // Lấy thông tin đơn hàng từ Worker (nếu cần)
          const response = await fetch(`https://your-worker-url.workers.dev/api/orders/${orderId}`);
          const orderData = await response.json();

          if (orderData.status === 'success') {
            renderOrderDetails(orderData.data);
          } else {
            renderFromLocalStorage();
          }
        } catch (error) {
          console.error('Lỗi khi lấy thông tin đơn hàng:', error);
          renderFromLocalStorage();
        }

        // Xóa giỏ hàng
        localStorage.removeItem('cart');
      });

      function getPaymentMethodName(method) {
        const methods = {
          payos: 'PayOS',
          sepay: 'SePay',
          vietqr: 'VietQR',
          qr: 'QR Code',
        };
        return methods[method.toLowerCase()] || method;
      }

      function renderFromLocalStorage() {
        // Fallback: Hiển thị từ localStorage nếu không lấy được từ server
        const cart = JSON.parse(localStorage.getItem('lastOrder') || '[]');
        let total = 0;

        const productsList = document.getElementById('products-list');
        productsList.innerHTML = '';

        if (cart.length === 0) {
          productsList.innerHTML = '<p>Không có thông tin sản phẩm</p>';
          return;
        }

        cart.forEach((item) => {
          total += item.price * item.quantity;

          const productItem = document.createElement('div');
          productItem.className = 'product-item';
          productItem.innerHTML = `
                    <img src="${item.img || 'https://via.placeholder.com/60?text=SP'}" 
                         class="product-image" 
                         alt="${item.name}"
                         onerror="this.src='https://via.placeholder.com/60?text=Ảnh+lỗi'">
                    <div class="product-info">
                        <div class="product-name">${item.name}</div>
                        <div class="product-price">
                            ${item.price.toLocaleString('vi-VN')} ₫ x ${item.quantity} = 
                            <strong>${(item.price * item.quantity).toLocaleString(
                              'vi-VN'
                            )} ₫</strong>
                        </div>
                    </div>
                `;

          productsList.appendChild(productItem);
        });

        document.getElementById('total-amount').textContent = total.toLocaleString('vi-VN') + ' ₫';
      }

      function renderOrderDetails(orderData) {
        // Hiển thị thông tin từ server
        document.getElementById('order-id').textContent = orderData.orderId;
        document.getElementById('order-date').textContent = new Date(
          orderData.timestamp
        ).toLocaleString('vi-VN');

        const productsList = document.getElementById('products-list');
        productsList.innerHTML = '';

        orderData.items.forEach((item) => {
          const productItem = document.createElement('div');
          productItem.className = 'product-item';
          productItem.innerHTML = `
                    <img src="${item.imageUrl || 'https://via.placeholder.com/60?text=SP'}" 
                         class="product-image" 
                         alt="${item.name}"
                         onerror="this.src='https://via.placeholder.com/60?text=Ảnh+lỗi'">
                    <div class="product-info">
                        <div class="product-name">${item.name}</div>
                        <div class="product-price">
                            ${item.price.toLocaleString('vi-VN')} ₫ x ${item.quantity} = 
                            <strong>${(item.price * item.quantity).toLocaleString(
                              'vi-VN'
                            )} ₫</strong>
                        </div>
                    </div>
                `;

          productsList.appendChild(productItem);
        });

        document.getElementById('total-amount').textContent =
          orderData.totalAmount.toLocaleString('vi-VN') + ' ₫';
      }
      // Script xử lý dữ liệu động
      if (window.orderData) {
        console.log('Dữ liệu đơn hàng:', window.orderData);
        // Cập nhật DOM với dữ liệu thực
        document.getElementById('order-id').textContent = window.orderData.orderId || '---';
        document.getElementById('total-amount').textContent =
          (window.orderData.amount || 0).toLocaleString('vi-VN') + ' ₫';
      }
    </script>
  </body>
</html>
